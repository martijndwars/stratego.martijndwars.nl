<code id="0"><span style="color: rgb(63, 127, 95)">/**</span></code>
<code id="1"><span style="color: rgb(63, 127, 95)"> * This module contains strategies for operating on hashtables.</span></code>
<code id="2"><span style="color: rgb(63, 127, 95)"> *</span></code>
<code id="3"><span style="color: rgb(63, 127, 95)"> * It is important to note that hashtables do not have value semantics;</span></code>
<code id="4"><span style="color: rgb(63, 127, 95)"> * all operations on hashtables will modify the existing hashtable.</span></code>
<code id="5"><span style="color: rgb(63, 127, 95)"> * Therefore, when you pass a hashtable to a strategy, it will modify</span></code>
<code id="6"><span style="color: rgb(63, 127, 95)"> * the hashtable by side-effect.</span></code>
<code id="7"><span style="color: rgb(63, 127, 95)"> *</span></code>
<code id="8"><span style="color: rgb(63, 127, 95)"> * Hash tables support constant time storing and retrieving of </span></code>
<code id="9"><span style="color: rgb(63, 127, 95)"> * values associated with keys. This module wraps the hashtable</span></code>
<code id="10"><span style="color: rgb(63, 127, 95)"> * facility provided by the ATerm library.</span></code>
<code id="11"><span style="color: rgb(63, 127, 95)"> *</span></code>
<code id="12"><span style="color: rgb(63, 127, 95)"> * @author Eelco Visser &lt;visser@acm.org&gt;</span></code>
<code id="13"><span style="color: rgb(63, 127, 95)"> * @author Martin Bravenboer &lt;martin.bravenboer@gmail.com&gt;</span></code>
<code id="14"><span style="color: rgb(63, 127, 95)"> * @author Karl Trygve Kalleberg &lt;karltk@strategoxt.org&gt; - some documentation</span></code>
<code id="15"><span style="color: rgb(63, 127, 95)"> *</span></code>
<code id="16"><span style="color: rgb(63, 127, 95)"> */</code>
<code id="17"></span><span style="color: rgb(127, 0, 85)">module</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">collection/hash-table/common</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="18"></span><span style="color: rgb(127, 0, 85)">imports</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="19"></span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 0)">collection/list</span><span style="color: rgb(0, 0, 128)">/</span><span style="color: rgb(0, 0, 128)">-</span></code>
<code id="20"></code>
<code id="21"><span style="color: rgb(127, 0, 85)">signature</span></code>
<code id="22"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(127, 0, 85)">constructors</span></code>
<code id="23"></code>
<code id="24"><span style="color: rgb(63, 127, 95)">    /**</span></code>
<code id="25"><span style="color: rgb(63, 127, 95)">     * Represents a reference to a hashtable.</span></code>
<code id="26"><span style="color: rgb(63, 127, 95)">     */</span></code>
<code id="27"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ImplDep</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span></code>
<code id="28"></code>
<code id="29"><span style="color: rgb(63, 127, 95)">/**</span></code>
<code id="30"><span style="color: rgb(63, 127, 95)"> * Hashtable construction and deconstruction</span></code>
<code id="31"><span style="color: rgb(63, 127, 95)"> */</code>
<code id="32"></span><span style="color: rgb(127, 0, 85)">strategies</span></code>
<code id="33"></code>
<code id="34"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="35"><span style="color: rgb(63, 127, 95)">   * Create a new hashtable with default size and load.</span></code>
<code id="36"><span style="color: rgb(63, 127, 95)">   * </span></code>
<code id="37"><span style="color: rgb(63, 127, 95)">   * @type _ -&gt; HashTable(K, V)</span></code>
<code id="38"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="39"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">new-hashtable</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="40"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">new-hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 128, 0)">117</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 128, 0)">75</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="41"></code>
<code id="42"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="43"><span style="color: rgb(63, 127, 95)">   * Create a new hashtable with specified size and load.</span></code>
<code id="44"><span style="color: rgb(63, 127, 95)">   * </span></code>
<code id="45"><span style="color: rgb(63, 127, 95)">   * @param initial_size - the initial capacity of the hashtable</span></code>
<code id="46"><span style="color: rgb(63, 127, 95)">   * @param max_load - the load percentage at which the hashtable is expanded</span></code>
<code id="47"><span style="color: rgb(63, 127, 95)">   * @type _ -&gt; HashTable(K, V)</span></code>
<code id="48"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="49"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">new-hashtable</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">initial_size</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">max_load</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="50"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">prim</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">&quot;SSL_hashtable_create&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">initial_size</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">max_load</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="51"></code>
<code id="52"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="53"><span style="color: rgb(63, 127, 95)">   * Destroys and deallocates memory consumed by an existing hashtable.</span></code>
<code id="54"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="55"><span style="color: rgb(63, 127, 95)">   * @type HashTable(K, V) -&gt; HashTable(K, V)</span></code>
<code id="56"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="57"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-destroy</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="58"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">prim</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">&quot;SSL_hashtable_destroy&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="59"></code>
<code id="60"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="61"><span style="color: rgb(63, 127, 95)">   * Clears the contents of an existing hashtable.</span></code>
<code id="62"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="63"><span style="color: rgb(63, 127, 95)">   * @type HashTable(K, V) -&gt; HashTable(K, V)</span></code>
<code id="64"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="65"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-clear</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="66"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">prim</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">&quot;SSL_hashtable_reset&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="67"></code>
<code id="68"><span style="color: rgb(63, 127, 95)">/**</span></code>
<code id="69"><span style="color: rgb(63, 127, 95)"> * Hashtable operations</span></code>
<code id="70"><span style="color: rgb(63, 127, 95)"> */</code>
<code id="71"></span><span style="color: rgb(127, 0, 85)">strategies</span></code>
<code id="72"></code>
<code id="73"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="74"><span style="color: rgb(63, 127, 95)">   * Puts a new key, value pair into the hash table. If the key is</span></code>
<code id="75"><span style="color: rgb(63, 127, 95)">   * already bound to a value, the old value will be replaced.</span></code>
<code id="76"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="77"><span style="color: rgb(63, 127, 95)">   * @param key - any term can be used as a key</span></code>
<code id="78"><span style="color: rgb(63, 127, 95)">   * @param value - any term can be used as a value</span></code>
<code id="79"><span style="color: rgb(63, 127, 95)">   * @type HashTable(K, V) -&gt; HashTable(K, V)</span></code>
<code id="80"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="81"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="82"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">prim</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">&quot;SSL_hashtable_put&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="83"></code>
<code id="84"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="85"><span style="color: rgb(63, 127, 95)">   * Gets the value for a key. If the key does not exist, this strategy</span></code>
<code id="86"><span style="color: rgb(63, 127, 95)">   * fails.</span></code>
<code id="87"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="88"><span style="color: rgb(63, 127, 95)">   * @param key</span></code>
<code id="89"><span style="color: rgb(63, 127, 95)">   * @type HashTable(K, V) -&gt; V</span></code>
<code id="90"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="91"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="92"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">prim</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">&quot;SSL_hashtable_get&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="93"></code>
<code id="94"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="95"><span style="color: rgb(63, 127, 95)">   * Removes a key (with its associated value) from the hashtable. This</span></code>
<code id="96"><span style="color: rgb(63, 127, 95)">   * strategy will succeed even if the key does not exist.</span></code>
<code id="97"><span style="color: rgb(63, 127, 95)">   * </span></code>
<code id="98"><span style="color: rgb(63, 127, 95)">   * @type HashTable(K, V) -&gt; HashTable(K, V)</span></code>
<code id="99"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="100"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="101"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">prim</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">&quot;SSL_hashtable_remove&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="102"><span style="color: rgb(63, 127, 95)">  </span></code>
<code id="103"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="104"><span style="color: rgb(63, 127, 95)">   * Get a list containing all keys of a hashtable.</span></code>
<code id="105"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="106"><span style="color: rgb(63, 127, 95)">   * @type HashTable(K, V) -&gt; List(K)</span></code>
<code id="107"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="108"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-keys</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="109"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">prim</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">&quot;SSL_hashtable_keys&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="110"></code>
<code id="111"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="112"><span style="color: rgb(63, 127, 95)">   * Get a list containing all values of a hashtable</span></code>
<code id="113"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="114"><span style="color: rgb(63, 127, 95)">   * @type HashTable(K, V) -&gt; List(V)</span></code>
<code id="115"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="116"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-values</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="117"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">htbl</span></code>
<code id="118"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-keys</span></code>
<code id="119"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">htbl</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="120"></code>
<code id="121"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="122"><span style="color: rgb(63, 127, 95)">   * Apply an iterative fold left (starting with first element) over</span></code>
<code id="123"><span style="color: rgb(63, 127, 95)">   * the keys of a hash table; useful for applying an operation to each</span></code>
<code id="124"><span style="color: rgb(63, 127, 95)">   * key without constructing a list of keys.</span></code>
<code id="125"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="126"><span style="color: rgb(63, 127, 95)">   * @param (k, v) * a -&gt; a</span></code>
<code id="127"><span style="color: rgb(63, 127, 95)">   * @param a</span></code>
<code id="128"><span style="color: rgb(63, 127, 95)">   * @type HashTable(k, v) -&gt; a</span></code>
<code id="129"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="130"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-fold</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">v</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">a</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">a</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">t</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </code>
<code id="131"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="132"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">prim</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">&quot;SSL_table_fold&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">t</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="133"></code>
<code id="134"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="135"><span style="color: rgb(63, 127, 95)">   * Apply an iterative fold left (starting with first element) over</span></code>
<code id="136"><span style="color: rgb(63, 127, 95)">   * the keys of a hash table; useful for applying an operation to each</span></code>
<code id="137"><span style="color: rgb(63, 127, 95)">   * key without constructing a list of keys.</span></code>
<code id="138"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="139"><span style="color: rgb(63, 127, 95)">   * @param k * a -&gt; a</span></code>
<code id="140"><span style="color: rgb(63, 127, 95)">   * @param a</span></code>
<code id="141"><span style="color: rgb(63, 127, 95)">   * @type HashTable(k, v) -&gt; a </span></code>
<code id="142"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="143"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-fold-keys</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">a</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">a</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">t</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </code>
<code id="144"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="145"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">prim</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">&quot;SSL_table_keys_fold&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">t</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="146"></code>
<code id="147"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="148"><span style="color: rgb(63, 127, 95)">   * Apply an iterative fold left (starting with first element) over</span></code>
<code id="149"><span style="color: rgb(63, 127, 95)">   * the values of a hash table; useful for applying an operation to each</span></code>
<code id="150"><span style="color: rgb(63, 127, 95)">   * value without constructing a list of values.</span></code>
<code id="151"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="152"><span style="color: rgb(63, 127, 95)">   * @param v * a -&gt; a</span></code>
<code id="153"><span style="color: rgb(63, 127, 95)">   * @param a</span></code>
<code id="154"><span style="color: rgb(63, 127, 95)">   * @type (v * a -&gt; a) * a * HashTable(k, v) -&gt; a </span></code>
<code id="155"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="156"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-fold-values</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">v</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">a</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">a</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">t</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </code>
<code id="157"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="158"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">prim</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">&quot;SSL_table_values_fold&quot;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">t</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="159"></code>
<code id="160"><span style="color: rgb(63, 127, 95)">/**</span></code>
<code id="161"><span style="color: rgb(63, 127, 95)"> * Hashtable bulk operations</span></code>
<code id="162"><span style="color: rgb(63, 127, 95)"> */</code>
<code id="163"></span><span style="color: rgb(127, 0, 85)">strategies</span></code>
<code id="164"></code>
<code id="165"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="166"><span style="color: rgb(63, 127, 95)">   * Get the contents of a hashtable as a list of key-value tuples.</span></code>
<code id="167"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="168"><span style="color: rgb(63, 127, 95)">   * @type HashTable(k,v) -&gt; List((k,v), ...)</span></code>
<code id="169"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="170"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-getlist</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="171"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">htbl</span></code>
<code id="172"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">let</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">insert</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">v</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">k</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">v</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">]</span></code>
<code id="173"><span style="color: rgb(63, 127, 95)">       </span><span style="color: rgb(127, 0, 85)">in</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-fold</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">insert</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="174"><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(127, 0, 85)">end</span></code>
<code id="175"></code>
<code id="176"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="177"><span style="color: rgb(63, 127, 95)">   * Put a list of key,value tuples into a hashtable.</span></code>
<code id="178"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="179"><span style="color: rgb(63, 127, 95)">   * @param kv         List(Tuple(K, V), ...)</span></code>
<code id="180"><span style="color: rgb(63, 127, 95)">   * @type HashTable(K, V) -&gt; HashTable(K, V)</span></code>
<code id="181"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="182"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-putlist</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">kv*</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="183"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">htbl</span></code>
<code id="184"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">htbl</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">kv*</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="185"></code>
<code id="186"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-putlist</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">f</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">ATerm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">*</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">kv*</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </code>
<code id="187"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">htbl</span></code>
<code id="188"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">f</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">htbl</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">kv*</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="189"></code>
<code id="190"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="191"><span style="color: rgb(63, 127, 95)">   * Create a new hashtable and initialize it from a key-value pair list.</span></code>
<code id="192"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="193"><span style="color: rgb(63, 127, 95)">   * @type List(Tuple(K, V), ...) -&gt; HashTable(K, V)</span></code>
<code id="194"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="195"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-init</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </code>
<code id="196"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">kv*</span></code>
<code id="197"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">new-hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">length</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 128, 0)">75</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="198"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-putlist</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">kv*</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="199"></code>
<code id="200"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="201"><span style="color: rgb(63, 127, 95)">   * Create a new hashtable and copies the entire contents of the current</span></code>
<code id="202"><span style="color: rgb(63, 127, 95)">   * table into the new one.</span></code>
<code id="203"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="204"><span style="color: rgb(63, 127, 95)">   * @type HashTable(K, V) -&gt; HashTable(K,V)</span></code>
<code id="205"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="206"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-copy</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="207"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">hashtable-getlist</span></code>
<code id="208"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-init</span></code>
<code id="209"></code>
<code id="210"><span style="color: rgb(63, 127, 95)">/**</span></code>
<code id="211"><span style="color: rgb(63, 127, 95)"> * Stack operations (when stored values in hashtables are list-based stacks)</span></code>
<code id="212"><span style="color: rgb(63, 127, 95)"> */</code>
<code id="213"></span><span style="color: rgb(127, 0, 85)">strategies</span></code>
<code id="214"></code>
<code id="215"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="216"><span style="color: rgb(63, 127, 95)">   * Pushes value on top of the stack for key.</span></code>
<code id="217"><span style="color: rgb(63, 127, 95)">   * Current term is the hashtable and remains untouched.</span></code>
<code id="218"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="219"><span style="color: rgb(63, 127, 95)">   * @param key        t - the key used for lookup</span></code>
<code id="220"><span style="color: rgb(63, 127, 95)">   * @param value      a - the value to insert</span></code>
<code id="221"><span style="color: rgb(63, 127, 95)">   * @type  HashTable(K, V) -&gt; HashTable(K, V)</span></code>
<code id="222"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="223"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-push</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="224"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="225"></code>
<code id="226"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="227"><span style="color: rgb(63, 127, 95)">   * Pushes values on top of the stack for key.</span></code>
<code id="228"><span style="color: rgb(63, 127, 95)">   * Current term is the hashtable and remains untouched.</span></code>
<code id="229"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="230"><span style="color: rgb(63, 127, 95)">   * @param key        t       - the key used for lookup</span></code>
<code id="231"><span style="color: rgb(63, 127, 95)">   * @param value      List(a) - the values to insert</span></code>
<code id="232"><span style="color: rgb(63, 127, 95)">   * @type  HashTable(K, V) -&gt; HashTable(K, V')</span></code>
<code id="233"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="234"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-pushlist</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="235"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">conc</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="236"></code>
<code id="237"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="238"><span style="color: rgb(63, 127, 95)">   * Pushes union of values and already present values </span></code>
<code id="239"><span style="color: rgb(63, 127, 95)">   * Current term is the hashtable.</span></code>
<code id="240"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="241"><span style="color: rgb(63, 127, 95)">   * @param key        t       - the key used for lookup</span></code>
<code id="242"><span style="color: rgb(63, 127, 95)">   * @param value      List(a) - the values to insert</span></code>
<code id="243"><span style="color: rgb(63, 127, 95)">   * @type  HashTable(K, V) -&gt; HashTable(K, V')</span></code>
<code id="244"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="245"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-pushunion</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="246"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">union</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="247"></code>
<code id="248"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="249"><span style="color: rgb(63, 127, 95)">   * Pops off the top element of the stack for key.</span></code>
<code id="250"><span style="color: rgb(63, 127, 95)">   * Current term is the hashtable and remains untouched.</span></code>
<code id="251"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="252"><span style="color: rgb(63, 127, 95)">   * @param key        t       - the key used for lookup</span></code>
<code id="253"><span style="color: rgb(63, 127, 95)">   * @type  HashTable(K, (V, ...)) -&gt; V</span></code>
<code id="254"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="255"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-pop</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="256"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">Tl</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="257"></code>
<code id="258"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="259"><span style="color: rgb(63, 127, 95)">   * Gets the top value from the stack for key (the stack remains untouched)</span></code>
<code id="260"><span style="color: rgb(63, 127, 95)">   * Current term is the hashtable, output is the top value.</span></code>
<code id="261"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="262"><span style="color: rgb(63, 127, 95)">   * @param key        t       - the key used for lookup</span></code>
<code id="263"><span style="color: rgb(63, 127, 95)">   * @type  HashTable(K, (V, ...)) -&gt; V</span></code>
<code id="264"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="265"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-peek</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="266"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">Hd</span></code>
<code id="267"></code>
<code id="268"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="269"><span style="color: rgb(63, 127, 95)">   * Gets the top value from the stack for key and pops it off the stack.</span></code>
<code id="270"><span style="color: rgb(63, 127, 95)">   * Current term is the hashtable, output is the top value.</span></code>
<code id="271"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="272"><span style="color: rgb(63, 127, 95)">   * @param key        t       - the key used for lookup</span></code>
<code id="273"><span style="color: rgb(63, 127, 95)">   * @type  HashTable(K, (V, ...)) -&gt; V</span></code>
<code id="274"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="275"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-peekpop</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="276"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">hashtable-peek</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="277"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-pop</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="278"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">val</span></code>
<code id="279"></code>
<code id="280"><span style="color: rgb(63, 127, 95)">/**</span></code>
<code id="281"><span style="color: rgb(63, 127, 95)"> * Mnemonic parameter strategies for hashtable-merge.</span></code>
<code id="282"><span style="color: rgb(63, 127, 95)"> */</span></code>
<code id="283"></code>
<code id="284"><span style="color: rgb(127, 0, 85)">strategies</span></code>
<code id="285"></code>
<code id="286"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">symmetric-yes</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(127, 0, 85)">id</span></code>
<code id="287"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">symmetric-no</span><span style="color: rgb(0, 64, 128)">  </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(127, 0, 85)">fail</span></code>
<code id="288"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">iterate1-yes</span><span style="color: rgb(0, 64, 128)">  </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(127, 0, 85)">id</span></code>
<code id="289"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">iterate1-no</span><span style="color: rgb(0, 64, 128)">   </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(127, 0, 85)">fail</span></code>
<code id="290"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">iterate2-yes</span><span style="color: rgb(0, 64, 128)">  </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(127, 0, 85)">id</span></code>
<code id="291"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">iterate2-no</span><span style="color: rgb(0, 64, 128)">   </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(127, 0, 85)">fail</span></code>
<code id="292"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">remove-yes</span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(127, 0, 85)">id</span></code>
<code id="293"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">remove-no</span><span style="color: rgb(0, 64, 128)">     </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(127, 0, 85)">fail</span></code>
<code id="294"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">default-no</span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(127, 0, 85)">fail</span></code>
<code id="295"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">change1-yes</span><span style="color: rgb(0, 64, 128)">   </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(127, 0, 85)">id</span></code>
<code id="296"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">change1-no</span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(127, 0, 85)">fail</span></code>
<code id="297"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">change2-yes</span><span style="color: rgb(0, 64, 128)">   </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(127, 0, 85)">id</span></code>
<code id="298"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">change2-no</span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(127, 0, 85)">fail</span></code>
<code id="299"></code>
<code id="300"><span style="color: rgb(127, 0, 85)">strategies</span></code>
<code id="301"></code>
<code id="302"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="303"><span style="color: rgb(63, 127, 95)">   * Merge two hashtables changing one or both.</span></code>
<code id="304"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="305"><span style="color: rgb(63, 127, 95)">   * This a highly generic strategy for merging two hashtables. The algorithm</span></code>
<code id="306"><span style="color: rgb(63, 127, 95)">   * is parameterized with a number of knobs that determine its behaviour.</span></code>
<code id="307"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="308"><span style="color: rgb(63, 127, 95)">   * (A little language for table merging!-)</span></code>
<code id="309"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="310"><span style="color: rgb(63, 127, 95)">   * @param symm     : apply changes to both tables, if not apply to tbl1.</span></code>
<code id="311"><span style="color: rgb(63, 127, 95)">   * @param iterate1 : iterate over keys of tbl1</span></code>
<code id="312"><span style="color: rgb(63, 127, 95)">   * @param iterate2 : iterate over keys of tbl2</span></code>
<code id="313"><span style="color: rgb(63, 127, 95)">   * @param remove   : remove table entry if undefined in other table</span></code>
<code id="314"><span style="color: rgb(63, 127, 95)">   * @param merge    : operation on pair of values</span></code>
<code id="315"><span style="color: rgb(63, 127, 95)">   * @param default  : default value in case lookup in other table fails</span></code>
<code id="316"><span style="color: rgb(63, 127, 95)">   * @param lookup1  : given a key produce value for left table</span></code>
<code id="317"><span style="color: rgb(63, 127, 95)">   * @param lookup2  : given a key produce value for right table</span></code>
<code id="318"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="319"><span style="color: rgb(63, 127, 95)">   * @todo : with a proper partial evaluator for Stratego this strategy can be</span></code>
<code id="320"><span style="color: rgb(63, 127, 95)">   *         used to create appropriately specialized algorithms.</span></code>
<code id="321"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="322"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-merge</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">symm</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">iterate1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">iterate2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">remove</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">merge</span></code>
<code id="323"><span style="color: rgb(63, 127, 95)">                 </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">default</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">change1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">change2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">lookup1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">lookup2</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">:</span></code>
<code id="324"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span></code>
<code id="325"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">iterate1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span></code>
<code id="326"><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-keys</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span></code>
<code id="327"><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">filter</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="328"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">key</span></code>
<code id="329"><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">lookup2</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="330"></span><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val1</span></code>
<code id="331"><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">val1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span></code>
<code id="332"><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">ior</span><span style="color: rgb(0, 0, 128)">(</span></code>
<code id="333"><span style="color: rgb(63, 127, 95)">                        </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">val1</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="334"></span><span style="color: rgb(63, 127, 95)">                          </span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)"> // no change to tbl1</span></code>
<code id="335"><span style="color: rgb(63, 127, 95)">                        </span><span style="color: rgb(127, 0, 85)">else</span></code>
<code id="336"><span style="color: rgb(63, 127, 95)">                          </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">change1</span></code>
<code id="337"><span style="color: rgb(63, 127, 95)">                        </span><span style="color: rgb(127, 0, 85)">end</span></code>
<code id="338"><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">symm</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">val2</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="339"></span><span style="color: rgb(63, 127, 95)">                          </span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)"> // no change to tbl2</span></code>
<code id="340"><span style="color: rgb(63, 127, 95)">                         </span><span style="color: rgb(127, 0, 85)">else</span></code>
<code id="341"><span style="color: rgb(63, 127, 95)">                          </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">change2</span></code>
<code id="342"><span style="color: rgb(63, 127, 95)">                        </span><span style="color: rgb(127, 0, 85)">end</span></code>
<code id="343"><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="344"><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">default</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span></code>
<code id="345"><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val1</span></code>
<code id="346"><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">val1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span></code>
<code id="347"><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">ior</span><span style="color: rgb(0, 0, 128)">(</span></code>
<code id="348"><span style="color: rgb(63, 127, 95)">                        </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">val1</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="349"></span><span style="color: rgb(63, 127, 95)">                          </span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)"> // no change to tbl1</span></code>
<code id="350"><span style="color: rgb(63, 127, 95)">                        </span><span style="color: rgb(127, 0, 85)">else</span></code>
<code id="351"><span style="color: rgb(63, 127, 95)">                          </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">change1</span></code>
<code id="352"><span style="color: rgb(63, 127, 95)">                        </span><span style="color: rgb(127, 0, 85)">end</span></code>
<code id="353"><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">symm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="354"></span><span style="color: rgb(63, 127, 95)">                          </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">change2</span></code>
<code id="355"><span style="color: rgb(63, 127, 95)">                        </span><span style="color: rgb(127, 0, 85)">end</span></code>
<code id="356"><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="357"><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"> // lookup2 failed, no default</span></code>
<code id="358"><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">remove</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="359"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">;</span></code>
<code id="360"><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">symm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span></code>
<code id="361"><span style="color: rgb(63, 127, 95)">                        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">change2</span></code>
<code id="362"><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)">                </span></code>
<code id="363"><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="364"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)"> // no change to either table            </span></code>
<code id="365"><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(127, 0, 85)">end</span></code>
<code id="366"><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">end</span></code>
<code id="367"><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="368"><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">changes1</span></code>
<code id="369"></code>
<code id="370"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">iterate2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span></code>
<code id="371"></code>
<code id="372"><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-keys</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span></code>
<code id="373"><span style="color: rgb(63, 127, 95)">            </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">filter</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="374"></span><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">key</span></code>
<code id="375"><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">iterate1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">not</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">end</span></code>
<code id="376"><span style="color: rgb(63, 127, 95)">                </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">lookup1</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="377"></span><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val2</span></code>
<code id="378"><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">val1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span></code>
<code id="379"><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">ior</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">val1</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="380"></span><span style="color: rgb(63, 127, 95)">                            </span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)"> // no change to tbl1</span></code>
<code id="381"><span style="color: rgb(63, 127, 95)">                          </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="382"></span><span style="color: rgb(63, 127, 95)">                            </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">change1</span></code>
<code id="383"><span style="color: rgb(63, 127, 95)">                          </span><span style="color: rgb(127, 0, 85)">end</span></code>
<code id="384"><span style="color: rgb(63, 127, 95)">                        </span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">symm</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">val2</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="385"></span><span style="color: rgb(63, 127, 95)">                           </span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)"> // no change to tbl2</span></code>
<code id="386"><span style="color: rgb(63, 127, 95)">                         </span><span style="color: rgb(127, 0, 85)">else</span></code>
<code id="387"><span style="color: rgb(63, 127, 95)">                           </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">change2</span></code>
<code id="388"><span style="color: rgb(63, 127, 95)">                         </span><span style="color: rgb(127, 0, 85)">end</span></code>
<code id="389"><span style="color: rgb(63, 127, 95)">                        </span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="390"><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">default</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="391"></span><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val2</span></code>
<code id="392"><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">val1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span></code>
<code id="393"><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span></code>
<code id="394"><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">symm</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">not</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">val2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="395"></span><span style="color: rgb(63, 127, 95)">                        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val3</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span></code>
<code id="396"><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(127, 0, 85)">end</span></code>
<code id="397"><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"> // lookup1 failed and no default</span></code>
<code id="398"><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">remove</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="399"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">;</span></code>
<code id="400"><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(127, 0, 85)">if</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">symm</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">then</span></code>
<code id="401"><span style="color: rgb(63, 127, 95)">                        </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">change2</span></code>
<code id="402"><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)">        </span></code>
<code id="403"><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="404"></span><span style="color: rgb(63, 127, 95)">                      </span><span style="color: rgb(127, 0, 85)">fail</span><span style="color: rgb(63, 127, 95)"> // no change to either table            </span></code>
<code id="405"><span style="color: rgb(63, 127, 95)">                    </span><span style="color: rgb(127, 0, 85)">end</span></code>
<code id="406"><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">end</span></code>
<code id="407"><span style="color: rgb(63, 127, 95)">              </span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="408"></code>
<code id="409"><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(127, 0, 85)">else</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">end</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">changes2</span></code>
<code id="410"><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">not</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">changes1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">not</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">changes2</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="411"></code>
<code id="412"></code>
<code id="413"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="414"><span style="color: rgb(63, 127, 95)">   * Version without change arguments for backward compatibility</span></code>
<code id="415"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="416"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-merge</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">symm</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">iterate1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">iterate2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">remove</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">merge</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">default</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="417"></span><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(0, 0, 0)">lookup1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">lookup2</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="418"><span style="color: rgb(0, 64, 128)">  </span><span style="color: rgb(0, 64, 128)">hashtable-merge</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">symm</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">iterate1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">iterate2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">remove</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">default</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="419"></span><span style="color: rgb(63, 127, 95)">                  </span><span style="color: rgb(0, 64, 128)">change1-yes</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">change2-yes</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">lookup1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">lookup2</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="420"></code>
<code id="421"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="422"><span style="color: rgb(63, 127, 95)">   * Merge hashtables creating a new one.</span></code>
<code id="423"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="424"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-merge-func</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">iterate1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">iterate2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">remove</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">merge</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">default</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">lookup1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">lookup2</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">:</span><span style="color: rgb(0, 64, 128)"> </code>
<code id="425"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl3</span></code>
<code id="426"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-copy</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl3</span></code>
<code id="427"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-merge</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">symmetric-no</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">iterate1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">iterate2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">remove</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">merge</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">default</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">lookup1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">lookup2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl3</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="428"></code>
<code id="429"><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // intersection merges</span></code>
<code id="430"></code>
<code id="431"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="432"><span style="color: rgb(63, 127, 95)">   * Intersect hashtables.</span></code>
<code id="433"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="434"><span style="color: rgb(63, 127, 95)">   * Changes tbl1; fails if no changes are made</span></code>
<code id="435"><span style="color: rgb(63, 127, 95)">   * Assumes that both hashtables contains lists as values, and intersects</span></code>
<code id="436"><span style="color: rgb(63, 127, 95)">   * the two listvalues for each key.</span></code>
<code id="437"><span style="color: rgb(63, 127, 95)">   * This is a 'pure' intersection: only keys that appear in both tables</span></code>
<code id="438"><span style="color: rgb(63, 127, 95)">   * remain in the input table, rest is removed.</span></code>
<code id="439"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="440"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-intersect</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="441"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">tbl1</span></code>
<code id="442"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="443"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-merge</span><span style="color: rgb(0, 0, 128)">(</span></code>
<code id="444"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">symmetric-no</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="445"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">iterate1-yes</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="446"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">iterate2-no</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="447"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">remove-yes</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)">        </span></code>
<code id="448"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">isect</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="449"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">default-no</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="450"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="451"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span></code>
<code id="452"><span style="color: rgb(63, 127, 95)">     </span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="453"></code>
<code id="454"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="455"><span style="color: rgb(63, 127, 95)">   * Intersect hashtables with default element.</span></code>
<code id="456"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="457"><span style="color: rgb(63, 127, 95)">   * Changes tbl1; fails if no changes are made</span></code>
<code id="458"><span style="color: rgb(63, 127, 95)">   * Assumes that both hashtables contains lists as values, and intersects</span></code>
<code id="459"><span style="color: rgb(63, 127, 95)">   * the two listvalues for each key.</span></code>
<code id="460"><span style="color: rgb(63, 127, 95)">   * Places a dummy value if key does not exist in one of the tables.</span></code>
<code id="461"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="462"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-intersect-wempty</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">emptyElt</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="463"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">tbl1</span></code>
<code id="464"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="465"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-merge</span><span style="color: rgb(0, 0, 128)">(</span></code>
<code id="466"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">symmetric-no</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="467"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">iterate1-yes</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="468"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">iterate2-yes</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="469"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">remove-no</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)">        </span></code>
<code id="470"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">isect</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="471"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">emptyElt</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="472"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="473"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span></code>
<code id="474"><span style="color: rgb(63, 127, 95)">     </span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="475"></code>
<code id="476"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="477"><span style="color: rgb(63, 127, 95)">   * Intersect hashtables symmetrically with default element.</span></code>
<code id="478"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="479"><span style="color: rgb(63, 127, 95)">   * Changes tbl1 and tbl2; fails if no changes are made in tbl1</span></code>
<code id="480"><span style="color: rgb(63, 127, 95)">   * Assumes that both hashtables contains lists as values, and intersects</span></code>
<code id="481"><span style="color: rgb(63, 127, 95)">   * the two listvalues for each key.</span></code>
<code id="482"><span style="color: rgb(63, 127, 95)">   * Places a dummy value if key does not exist in one of the tables.</span></code>
<code id="483"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="484"></code>
<code id="485"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-intersect-symm-wempty</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">emptyElt</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="486"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="487"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-merge</span><span style="color: rgb(0, 0, 128)">(</span></code>
<code id="488"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">symmetric-yes</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="489"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">iterate1-yes</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="490"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">iterate2-yes</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="491"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">remove-no</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="492"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">isect</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="493"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">emptyElt</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="494"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="495"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span></code>
<code id="496"><span style="color: rgb(63, 127, 95)">     </span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="497"></code>
<code id="498"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="499"><span style="color: rgb(63, 127, 95)">   * Intersect hashtables symmetrically with default element.</span></code>
<code id="500"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="501"><span style="color: rgb(63, 127, 95)">   * Changes tbl1 and tbl2; fails if no changes are made in tbl1</span></code>
<code id="502"><span style="color: rgb(63, 127, 95)">   * Assumes that both hashtables contains lists as values, and intersects</span></code>
<code id="503"><span style="color: rgb(63, 127, 95)">   * the two listvalues for each key.</span></code>
<code id="504"><span style="color: rgb(63, 127, 95)">   * Places a dummy value if key does not exist in one of the tables.</span></code>
<code id="505"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="506"></code>
<code id="507"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-intersect-symm-wempty-ignore-left</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">emptyElt</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="508"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="509"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-merge</span><span style="color: rgb(0, 0, 128)">(</span></code>
<code id="510"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">symmetric-yes</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="511"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">iterate1-yes</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="512"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">iterate2-yes</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="513"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">remove-no</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="514"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">isect</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="515"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">emptyElt</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="516"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">change1-no</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="517"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">change2-yes</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="518"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="519"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span></code>
<code id="520"><span style="color: rgb(63, 127, 95)">     </span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="521"></code>
<code id="522"><span style="color: rgb(127, 0, 85)">strategies</span><span style="color: rgb(63, 127, 95)"> // union merges</span></code>
<code id="523"></code>
<code id="524"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="525"><span style="color: rgb(63, 127, 95)">   * Union of hashtables</span></code>
<code id="526"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="527"><span style="color: rgb(63, 127, 95)">   * Changes tbl1; fails if no changes are made</span></code>
<code id="528"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="529"></code>
<code id="530"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-union</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="531"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">tbl1</span></code>
<code id="532"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="533"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-merge</span><span style="color: rgb(0, 0, 128)">(</span></code>
<code id="534"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">symmetric-no</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="535"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">iterate1-no</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="536"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">iterate2-yes</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="537"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">remove-no</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)">        </span></code>
<code id="538"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">union</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="539"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="540"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="541"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">fail</span></code>
<code id="542"><span style="color: rgb(63, 127, 95)">     </span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="543"></code>
<code id="544"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-union-wempty</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">emptyElt</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="545"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">tbl1</span></code>
<code id="546"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="547"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-merge</span><span style="color: rgb(0, 0, 128)">(</span></code>
<code id="548"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">symmetric-no</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="549"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">iterate1-no</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="550"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">iterate2-yes</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="551"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">remove-no</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)">        </span></code>
<code id="552"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">union</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="553"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">emptyElt</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="554"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="555"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(127, 0, 85)">fail</span></code>
<code id="556"><span style="color: rgb(63, 127, 95)">     </span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="557"></code>
<code id="558"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-union-symm-wempty</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">emptyElt</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="559"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="560"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-merge</span><span style="color: rgb(0, 0, 128)">(</span></code>
<code id="561"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">symmetric-yes</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="562"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">iterate1-yes</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="563"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">iterate2-yes</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="564"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">remove-no</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)">        </span></code>
<code id="565"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 64, 128)">union</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="566"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">emptyElt</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="567"></span><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(0, 0, 128)">,</span></code>
<code id="568"><span style="color: rgb(63, 127, 95)">        </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span></code>
<code id="569"><span style="color: rgb(63, 127, 95)">     </span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="570"></code>
<code id="571"><span style="color: rgb(127, 0, 85)">strategies</span></code>
<code id="572"></code>
<code id="573"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="574"><span style="color: rgb(63, 127, 95)">   * Checks whether two hashtables have equal contents.</span></code>
<code id="575"><span style="color: rgb(63, 127, 95)">   * This strategy uses the basic `eq` to compare the elements.</span></code>
<code id="576"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="577"><span style="color: rgb(63, 127, 95)">   * @type Tuple(HashTable(K, V), HashTable(K,V)) -&gt; _</span></code>
<code id="578"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="579"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-eq</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </code>
<code id="580"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">hashtable-eq</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">eq</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="581"></code>
<code id="582"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="583"><span style="color: rgb(63, 127, 95)">   * Checks whether two tables have the same keys, and for each key whether</span></code>
<code id="584"><span style="color: rgb(63, 127, 95)">   * the associated values are the same (order of keys thus doesn't matter)</span></code>
<code id="585"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="586"><span style="color: rgb(63, 127, 95)">   * @param test strategy that will compare two elements upon their equality.</span></code>
<code id="587"><span style="color: rgb(63, 127, 95)">   * @inc hashtable-eq</span></code>
<code id="588"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="589"><span style="color: rgb(63, 127, 95)">   * @type Tuple(HashTable(K, V), HashTable(K,V)) -&gt; _</span></code>
<code id="590"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="591"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-eq</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">eq</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span></code>
<code id="592"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">hashtable-keys</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">k*</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-keys</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">set-eq</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="593"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">eq</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">tbl2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">k*</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="594"></code>
<code id="595"><span style="color: rgb(63, 127, 95)">/**</span></code>
<code id="596"><span style="color: rgb(63, 127, 95)"> * Legacy table strategies</span></code>
<code id="597"><span style="color: rgb(63, 127, 95)"> */</code>
<code id="598"></span><span style="color: rgb(127, 0, 85)">strategies</span></code>
<code id="599"></code>
<code id="600"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="601"><span style="color: rgb(63, 127, 95)">   * Retrieves the primitive table-table as a Hashtable</span></code>
<code id="602"><span style="color: rgb(63, 127, 95)">   *</span></code>
<code id="603"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="604"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-hashtable</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="605"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(127, 0, 85)">prim</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">&quot;SSL_table_hashtable&quot;</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">Hashtable</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(127, 0, 85)">id</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="606"></code>
<code id="607"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="608"><span style="color: rgb(63, 127, 95)">   * Retrieves a named table by looking it up in the table-table.</span></code>
<code id="609"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="610"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">lookup-table</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 64, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="611"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 64, 128)">table-hashtable</span></code>
<code id="612"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="613"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-create</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="614"></code>
<code id="615"><span style="color: rgb(63, 127, 95)"> /**</span></code>
<code id="616"><span style="color: rgb(63, 127, 95)">  * Creates a table with a given name, which can be any term.</span></code>
<code id="617"><span style="color: rgb(63, 127, 95)">  */</span></code>
<code id="618"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-create</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </code>
<code id="619"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">name</span></code>
<code id="620"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">new-hashtable</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">htbl</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="621"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">table-hashtable</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">htbl</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="622"></code>
<code id="623"><span style="color: rgb(63, 127, 95)">  /**</span></code>
<code id="624"><span style="color: rgb(63, 127, 95)">   * Destroy a table with a given name, which can be any term.</span></code>
<code id="625"><span style="color: rgb(63, 127, 95)">   */</span></code>
<code id="626"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-destroy</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </code>
<code id="627"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">name</span></code>
<code id="628"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">table-hashtable</span></code>
<code id="629"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">lookup-table</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="630"><span style="color: rgb(63, 127, 95)">          </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-destroy</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="631"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="632"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="633"></code>
<code id="634"><span style="color: rgb(63, 127, 95)"> /**</span></code>
<code id="635"><span style="color: rgb(63, 127, 95)">  * Associate a value with a key in a table. </span></code>
<code id="636"><span style="color: rgb(63, 127, 95)">  *</span></code>
<code id="637"><span style="color: rgb(63, 127, 95)">  * E.g. &lt;table-put&gt; (t1, key, value) associates value with key in the t1 table.</span></code>
<code id="638"><span style="color: rgb(63, 127, 95)">  */</span></code>
<code id="639"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-put</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </code>
<code id="640"></span><span style="color: rgb(0, 64, 128)">  </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span></code>
<code id="641"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="642"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">lookup-table</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="643"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="644"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="645"></code>
<code id="646"><span style="color: rgb(63, 127, 95)"> /**</span></code>
<code id="647"><span style="color: rgb(63, 127, 95)">  * Get the value associated with a key from a table.</span></code>
<code id="648"><span style="color: rgb(63, 127, 95)">  * </span></code>
<code id="649"><span style="color: rgb(63, 127, 95)">  * E.g. &lt;table-get&gt; (t1, key) yields the value associated to key or fails in the t1 table.</span></code>
<code id="650"><span style="color: rgb(63, 127, 95)">  */</span></code>
<code id="651"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-get</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </code>
<code id="652"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="653"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">lookup-table</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="654"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-get</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="655"></code>
<code id="656"><span style="color: rgb(63, 127, 95)"> /**</span></code>
<code id="657"><span style="color: rgb(63, 127, 95)">  * Remove association of a key in a table.</span></code>
<code id="658"><span style="color: rgb(63, 127, 95)">  *</span></code>
<code id="659"><span style="color: rgb(63, 127, 95)">  * E.g. &lt;table-remove&gt; (t1, key) removes the entry for key from table t1.</span></code>
<code id="660"><span style="color: rgb(63, 127, 95)">  */</span></code>
<code id="661"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-remove</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </code>
<code id="662"></span><span style="color: rgb(0, 64, 128)">  </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span></code>
<code id="663"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="664"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">lookup-table</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="665"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="666"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="667"></code>
<code id="668"><span style="color: rgb(63, 127, 95)"> /**</span></code>
<code id="669"><span style="color: rgb(63, 127, 95)">  * Produce a list of keys of a table.</span></code>
<code id="670"><span style="color: rgb(63, 127, 95)">  *</span></code>
<code id="671"><span style="color: rgb(63, 127, 95)">  * E.g. &lt;table-keys&gt;t1 produces the list of keys of table t1.</span></code>
<code id="672"><span style="color: rgb(63, 127, 95)">  */</span></code>
<code id="673"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-keys</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </code>
<code id="674"></span><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">name</span></code>
<code id="675"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">lookup-table</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="676"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-keys</span></code>
<code id="677"></code>
<code id="678"><span style="color: rgb(63, 127, 95)"> /**</span></code>
<code id="679"><span style="color: rgb(63, 127, 95)">  * Renames a table, i.e. only the entry in the table-table is renamed,</span></code>
<code id="680"><span style="color: rgb(63, 127, 95)">  * the table contents remain untouched.</span></code>
<code id="681"><span style="color: rgb(63, 127, 95)">  */</span></code>
<code id="682"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-rename</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span></code>
<code id="683"><span style="color: rgb(0, 64, 128)">    </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">from-name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">to-name</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="684"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">lookup-table</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">from-name</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">htbl</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="685"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">table-hashtable</span></code>
<code id="686"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-put</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">to-name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">htbl</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="687"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">hashtable-remove</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">from-name</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="688"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">to-name</span></code>
<code id="689"></code>
<code id="690"></code>
<code id="691"><span style="color: rgb(127, 0, 85)">strategies</span></code>
<code id="692"></code>
<code id="693"><span style="color: rgb(63, 127, 95)"> /**</span></code>
<code id="694"><span style="color: rgb(63, 127, 95)">  * Get a list of key-value pairs.</span></code>
<code id="695"><span style="color: rgb(63, 127, 95)">  *</span></code>
<code id="696"><span style="color: rgb(63, 127, 95)">  * E.g. &lt;table-getlist&gt;t1 produces the list of (key,value) pairs in the table t1. </span></code>
<code id="697"><span style="color: rgb(63, 127, 95)">  */</span></code>
<code id="698"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-getlist</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="699"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 64, 128)">table-keys</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">x</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">-&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">x</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-get</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">x</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">\</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="700"></code>
<code id="701"><span style="color: rgb(63, 127, 95)"> /**</span></code>
<code id="702"><span style="color: rgb(63, 127, 95)">  * Put a list of key-value pairs in a table.</span></code>
<code id="703"><span style="color: rgb(63, 127, 95)">  *</span></code>
<code id="704"><span style="color: rgb(63, 127, 95)">  * E.g. &lt;table-putlist&gt;(name, list) puts the (key,value) pairs in list into table t1.</span></code>
<code id="705"><span style="color: rgb(63, 127, 95)">  */</span></code>
<code id="706"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-putlist</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">list</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="707"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">x</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">y</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">x</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">y</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-put</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">x</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">y</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">list</span></code>
<code id="708"></code>
<code id="709"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-putlist</span><span style="color: rgb(0, 64, 128)">(</span><span style="color: rgb(0, 0, 0)">s</span><span style="color: rgb(0, 64, 128)">)</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">list</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="710"></span><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">map</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">{</span><span style="color: rgb(0, 0, 0)">x</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(0, 0, 0)">y</span><span style="color: rgb(0, 0, 128)">:</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">x</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">y</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">s</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">name</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">x</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">y</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">}</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">list</span></code>
<code id="711"></code>
<code id="712"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-copy</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">name1</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">name2</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span></code>
<code id="713"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-putlist</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">name2</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-getlist</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 0)">name1</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </code>
<code id="714"></span></code>
<code id="715"></code>
<code id="716"><span style="color: rgb(63, 127, 95)">/*</span></code>
<code id="717"><span style="color: rgb(63, 127, 95)">        Symbol tables that deal with scoped bindings need to be able</span></code>
<code id="718"><span style="color: rgb(63, 127, 95)">        to store multiple bindings for the same symbol. The following</span></code>
<code id="719"><span style="color: rgb(63, 127, 95)">        table operations can be used to maintain a stack (list)</span></code>
<code id="720"><span style="color: rgb(63, 127, 95)">        of values for each key.</span></code>
<code id="721"><span style="color: rgb(63, 127, 95)">*/</span></code>
<code id="722"></code>
<code id="723"><span style="color: rgb(127, 0, 85)">strategies</span></code>
<code id="724"></code>
<code id="725"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-push</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">dis</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span></code>
<code id="726"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-put</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">dis</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">val</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-get</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">dis</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="727"></code>
<code id="728"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-pop</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">dis</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span></code>
<code id="729"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-put</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">dis</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-get</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">Tl</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">dis</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="730"></code>
<code id="731"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-pop-rm</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">dis</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span></code>
<code id="732"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span></code>
<code id="733"><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-get</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">dis</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">xs</span><span style="color: rgb(0, 0, 128)">]</span></code>
<code id="734"><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-put</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">dis</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">xs</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="735"><span style="color: rgb(63, 127, 95)">      </span><span style="color: rgb(0, 0, 128)">+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-remove</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">dis</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="736"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="737"></code>
<code id="738"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-pop-get</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">dis</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span></code>
<code id="739"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-get</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">dis</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">val</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">vals</span><span style="color: rgb(0, 0, 128)">]</span></code>
<code id="740"><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-put</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">dis</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">vals</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="741"><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 0)">val</span></code>
<code id="742"></code>
<code id="743"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-lookup</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">dis</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span></code>
<code id="744"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-get</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">dis</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">Hd</span></code>
<code id="745"></code>
<code id="746"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-replace</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">dis</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span></code>
<code id="747"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-get</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">dis</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">=&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">_</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">values</span><span style="color: rgb(0, 0, 128)">]</span></code>
<code id="748"><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-put</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">dis</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 0)">value</span><span style="color: rgb(0, 0, 128)">|</span><span style="color: rgb(0, 0, 0)">values</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="749"><span style="color: rgb(63, 127, 95)">         </span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="750"></code>
<code id="751"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-union</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">table</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span></code>
<code id="752"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-put</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">table</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">union</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">val</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-get</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">table</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="753"></code>
<code id="754"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-diff</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">table</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span></code>
<code id="755"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-put</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">table</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">diff</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-get</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">table</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span></code>
<code id="756"></code>
<code id="757"><span style="color: rgb(63, 127, 95)">  </span><span style="color: rgb(0, 64, 128)">table-append</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 64, 128)">=</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">?</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">table</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">;</span></code>
<code id="758"><span style="color: rgb(63, 127, 95)">    </span><span style="color: rgb(127, 0, 85)">where</span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-put</span><span style="color: rgb(0, 0, 128)">&gt;</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">table</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">union</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 64, 128)">&lt;</span><span style="color: rgb(0, 64, 128)">table-get</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">&lt;+</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 128)">!</span><span style="color: rgb(0, 0, 128)">[</span><span style="color: rgb(0, 0, 128)">]</span><span style="color: rgb(0, 64, 128)">&gt;</span><span style="color: rgb(0, 64, 128)"> </span><span style="color: rgb(0, 0, 128)">(</span><span style="color: rgb(0, 0, 0)">table</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">key</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">,</span><span style="color: rgb(63, 127, 95)"> </span><span style="color: rgb(0, 0, 0)">val</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span><span style="color: rgb(0, 0, 128)">)</span></code>